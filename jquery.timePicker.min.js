/*
 * A time picker for jQuery
 *
 * Dual licensed under the MIT and GPL licenses.
 * Copyright (c) 2009 Anders Fajerson
 * @name     timePicker
 * @author   Anders Fajerson (http://perifer.se)
 * @example  $("#mytime").timePicker();
 * @example  $("#mytime").timePicker({step:30, startTime:"15:00", endTime:"18:00"});
 *
 * Based on timePicker by Sam Collet (http://www.texotela.co.uk/code/jquery/timepicker/)
 *
 * Options:
 *   step: # of minutes to step the time by
 *   startTime: beginning of the range of acceptable times
 *   endTime: end of the range of acceptable times
 *   separator: separator string to use between hours and minutes (e.g. ':')
 *   show24Hours: use a 24-hour scheme
 */
 
!function(m){function g(e,t,s){e.value=m(t).text(),m(e).change(),e.focus(),s.hide()}function k(e,t){var s=e.getHours(),r=t.show24Hours?s:(s+11)%12+1,i=e.getMinutes();return o(r)+t.separator+o(i)+(t.show24Hours?"":s<12?" AM":" PM")}function o(e){return(e<10?"0":"")+e}function i(e,t){return"object"==typeof e?w(e):T(e,t)}function T(e,t){if(e){var s=e.split(t.separator),r=parseFloat(s[0]),i=parseFloat(s[1]);return t.show24Hours||(12===r&&-1!==e.indexOf("AM")?r=0:12!==r&&-1!==e.indexOf("PM")&&(r+=12)),w(new Date(0,0,0,r,i,0))}return null}function w(e){return e.setFullYear(2001),e.setMonth(0),e.setDate(0),e}m.fn.timePicker=function(e){var t=m.extend({},m.fn.timePicker.defaults,e);return this.each(function(){m.timePicker(this,t)})},m.timePicker=function(e,t){var s=m(e)[0];return s.timePicker||(s.timePicker=new jQuery._timePicker(s,t))},m.timePicker.version="0.3",m._timePicker=function(u,a){var e=!1,n=!1,f=i(a.startTime,a),l=i(a.endTime,a),c="selected",d="li."+c;m(u).attr("autocomplete","OFF");for(var t=[],s=new Date(f);s<=l;)t[t.length]=k(s,a),s=new Date(s.setMinutes(s.getMinutes()+a.step));for(var p=m('<div class="time-picker'+(a.show24Hours?"":" time-picker-12hours")+'"></div>'),h=m("<ul></ul>"),r=0;r<t.length;r++)h.append("<li>"+t[r]+"</li>");p.append(h),p.appendTo("body").hide(),p.mouseover(function(){e=!0}).mouseout(function(){e=!1}),m("li",h).mouseover(function(){n||(m(d,p).removeClass(c),m(this).addClass(c))}).mousedown(function(){e=!0}).click(function(){g(u,this,p),e=!1});function v(){if(p.is(":visible"))return!1;m("li",p).removeClass(c);var e=m(u).offset();p.css({top:e.top+u.offsetHeight,left:e.left}),p.show();var t=u.value?T(u.value,a):f,s=60*f.getHours()+f.getMinutes(),r=60*t.getHours()+t.getMinutes()-s,i=Math.round(r/a.step),o=w(new Date(0,0,0,0,i*a.step+s,0)),n=m("li:contains("+k(o=f<o&&o<=l?o:f,a)+")",p);return n.length&&(n.addClass(c),p[0].scrollTop=n[0].offsetTop),!0}m(u).focus(v).click(v),m(u).blur(function(){e||p.hide()});m(u).keydown(function(e){var t;n=!0;var s,r=p[0].scrollTop;switch(e.keyCode){case 38:if(v())return!1;var i=(t=m(d,h)).prev().addClass(c)[0];return i?(t.removeClass(c),i.offsetTop<r&&(p[0].scrollTop=r-i.offsetHeight)):(t.removeClass(c),i=m("li:last",h).addClass(c)[0],p[0].scrollTop=i.offsetTop-i.offsetHeight),!1;case 40:if(v())return!1;var o=(t=m(d,h)).next().addClass(c)[0];return o?(t.removeClass(c),o.offsetTop+o.offsetHeight>r+p[0].offsetHeight&&(p[0].scrollTop=r+o.offsetHeight)):(t.removeClass(c),o=m("li:first",h).addClass(c)[0],p[0].scrollTop=0),!1;case 13:return p.is(":visible")&&(s=m(d,h)[0],g(u,s,p)),!1;case 27:return p.hide(),!1}return!0}),m(u).keyup(function(e){n=!1}),this.getTime=function(){return T(u.value,a)},this.setTime=function(e){u.value=k(i(e,a),a),m(u).change()}},m.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:!0}}(jQuery);